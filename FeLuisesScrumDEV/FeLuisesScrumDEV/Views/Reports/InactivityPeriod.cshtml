<!DOCTYPE html>
<html>
<head>
    @{
        Layout = "~/Views/Shared/_Layout.cshtml";
    }
    <link href="~/FeStyles/feLuisesStyles.css" rel="stylesheet" type="text/css">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Periodos de inactividad</title>

	<script>
		function getPeriods() {
                var idEmployee = document.getElementById("EmployeeSelect").value;
			    $.ajax({
                        type: "post",
                        dataType: "json",
                        url: '@Url.Action("BringPeriod", "Reports")',
                        traditional: true,
                        async: false,
                        data: {
                            currentEmployee: idEmployee
                        },
						success: function (json) {
                            var myArray = json.myArray;
                            console.log(myArray);
							var periodo = "";
                            var Total = 0;
                            var aux = "";
                            var date1;
                            var date2;
                            var difDates;
                            var table = document.getElementById("myTable");
                            table.innerHTML = " <tr><td><b>Períodos</b></td><td><b>Horas</b></td></tr>";
							for (var i = 0; i < myArray.length; i++){
                                periodo = "";
                                if (i % 2 === 0) {
                                    date1 = new Date(myArray[i]);
                                    aux = myArray[i] + " - ";
								} else {
                                    periodo = aux + myArray[i];
                                    console.log(periodo);
                                    date2 = new Date(myArray[i]);
                                    difDates = (date2.getTime() - date1.getTime())/(1000 * 3600 * 24)
								    var row = table.insertRow();
								    var cell1 = row.insertCell(0);
								    var cell2 = row.insertCell(1);
                                    cell1.innerHTML = periodo;
                                    cell2.innerHTML = Math.floor(difDates);
                                    Total += Math.floor(difDates);
								}
                            }

                            var row = table.insertRow();
							var cell1 = row.insertCell(0);
							var cell2 = row.insertCell(1);
                            cell1.innerHTML = "<b>Total</b>";
                            cell2.innerHTML = "<b>" + Total + "</b>";
                        },
                        error: function (errorList) {
                            console.log(errorList);
                        }
                })
         }
	</script>

</head>
<body>

	@if (Session["userName"] == null && (Convert.ToInt32(Session["userRole"]) != 0))
	{
		<div class="container">

			<div class="card">
				<div class="card-header">
					<h2 id="heading-red">No se vale hackear!</h2>
				</div>
				<div class="card-body">
					<h5 class="card-title">Debe logguearse para hacer uso de la aplicación</h5>
					<a href=@Url.Action("Index", "Login") class="btn btn-danger">Volver</a>
				</div>
			</div>
		</div>
	}
	else
	{
        <div class="container">
            <h3>Periodos de desocupación de los desarrolladores dentro de un rango de fechas</h3>
            <br />
            <br />
            @*<div class="form-control" type="date" ></div>*@
            @Html.DropDownList("idEmployeePK", null, htmlAttributes: new { @class = "form-control", @id = "EmployeeSelect", @onchange = "getPeriods()" })
            <br />

            <h4 id="employeeName"></h4>

            <br />
            <br />
            @*class="table table-striped table-bordered"*@
            <table id="myTable" class="table table-striped table-bordered">

                @*<thead>
                    <th>
                        Períodos
                    </th>
                    <th>
                        Horas
                    </th>
                    </thead>*@

                <tr>
                    <td>
                        <b>Períodos</b>
                    </td>
                    <td>
                        <b>Horas</b>
                    </td>
                </tr>

                @*<tbody></tbody>*@

            </table>

        </div>
	
	}

</body>
</html>
